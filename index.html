<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Ping Pong (with optional AI)</title>
<style>
    body {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: #111;
        color: #eee;
        font-family: sans-serif;
    }
    canvas {
        border: 2px solid #fff;
        background: #000;
    }
    #ui {
        position: absolute;
        top: 24px;
        left: 0;
        width: 100%;
        text-align: center;
    }
    button {
        margin: 0 6px;
        font-size: 16px;
        padding: 6px 12px;
        background: #06f;
        color: #fff;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background: #08f;
    }
</style>
</head>
<body>
<div id="ui">
    <button id="newBtn">New Game</button>
    <button id="modeBtn">1 Player</button>
</div>

<canvas id="game" width="640" height="320"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const paddleWidth = 10, paddleHeight = 70, paddleSpeed = 5;
const aiSpeed = 3.5;          // keep slightly below max human speed

let left = { y: H/2 - paddleHeight/2, points: 0 };
let right = { y: H/2 - paddleHeight/2, points: 0 };
let aiMode = true;

let ball = { x: W/2, y: H/2, vx: 3, vy: 2, r: 6 };

let gameOver = true;
let keys = {}, anim;

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

function resetBall() {
    ball.x = W/2; ball.y = H/2;
    ball.vx = (Math.random() < 0.5 ? 1 : -1)*(3 + Math.random()*2);
    ball.vy = (Math.random()*2 - 1)*(2 + Math.random()*1.5);
}

function update() {
    if (gameOver) return;

    // Left (always human) W/S
    if (keys['w'] || keys['W']) left.y = Math.max(left.y - paddleSpeed, 0);
    if (keys['s'] || keys['S']) left.y = Math.min(left.y + paddleSpeed, H);

    // Right paddle: AI or human
    if (aiMode) {
        const targetY = ball.y - paddleHeight / 2;
        if (right.y < targetY) right.y = Math.min(right.y + aiSpeed, H - paddleHeight);
        if (right.y > targetY) right.y = Math.max(right.y - aiSpeed, 0);
    } else {
        if (keys['ArrowUp'])   right.y = Math.max(right.y - paddleSpeed, 0);
        if (keys['ArrowDown']) right.y = Math.min(right.y + paddleSpeed, H);
    }

    // Ball physics
    ball.x += ball.vx; ball.y += ball.vy;
    if (ball.y - ball.r <= 0 || ball.y + ball.r >= H) ball.vy *= -1;

    // Paddle collision
    if (ball.x - ball.r <= paddleWidth &&
        ball.y >= left.y && ball.y <= left.y + paddleHeight) ball.vx = Math.abs(ball.vx);
    if (ball.x + ball.r >= W - paddleWidth &&
        ball.y >= right.y && ball.y <= right.y + paddleHeight) ball.vx = -Math.abs(ball.vx);

    // Scoring
    if (ball.x < -ball.r) { right.points++; resetBall(); checkWin(); }
    if (ball.x > W + ball.r) { left.points++; resetBall(); checkWin(); }
}

function checkWin() {
    if (left.points === 5 || right.points === 5) {
        gameOver = true;
        document.getElementById('newBtn').innerText = 'Game Over â€“ New Game';
        cancelAnimationFrame(anim);
    }
}

function draw() {
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#fff';
    // Paddles
    ctx.fillRect(0, left.y, paddleWidth, paddleHeight);
    ctx.fillRect(W - paddleWidth, right.y, paddleWidth, paddleHeight);
    // Ball
    ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
    // Centre dash
    ctx.beginPath(); ctx.setLineDash([7,7]); ctx.moveTo(W/2, 0); ctx.lineTo(W/2, H);
    ctx.strokeStyle = '#fff'; ctx.stroke(); ctx.setLineDash([]);
    // Score
    ctx.font = '32px sans-serif';
    ctx.fillText(left.points, W/2 - 28, 40);
    ctx.fillText(right.points, W/2 + 10, 40);
}

function loop() {
    update();
    draw();
    anim = requestAnimationFrame(loop);
}

// UI handlers
document.getElementById('newBtn').addEventListener('click', () => {
    left.points = 0; right.points = 0; gameOver = false;
    resetBall(); document.getElementById('newBtn').innerText = 'New Game';
    loop();
});

document.getElementById('modeBtn').addEventListener('click', () => {
    aiMode = !aiMode;
    document.getElementById('modeBtn').innerText = aiMode ? '2 Player' : '1 Player';
});

draw(); // initial static board
</script>
</body>
</html>
